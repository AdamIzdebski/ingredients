<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregates Ceteris Paribus Profiles — aggregate_profiles • ingredients</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class = "navbar-mi2logo" href="http://DrWhy.AI/">
        <img src = "https://github.com/ModelOriented/DrWhyTemplate/blob/master/inst/pkgdown/assets/drwhy_znak_violet_small.jpg?raw=true" alt = "MI2" height = 46 title = "MI2">
	  </a>
      <a class="navbar-brand navbar-mi2" href="../index.html">Aggregates Ceteris Paribus Profiles</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/vignette_aspect_importance.html">Vignette for aspect importance</a>
    </li>
    <li>
      <a href="../articles/vignette_titanic.html">Survival on the RMS Titanic</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregates Ceteris Paribus Profiles</h1>
    </div>

    
    <p>The function 'aggregate_profiles' calculates an aggregate of ceteris paribus profiles.
It can be: Partial Dependency Profile (average across Ceteris Paribus Profiles),
Conditional Dependency Profile (local weighted average across Ceteris Paribus Profiles) or
Accumulated Local Dependency Profile (cummulated average local changes in Ceteris Paribus Profiles).</p>
    

    <pre class="usage"><span class='fu'>aggregate_profiles</span>(<span class='no'>x</span>, <span class='no'>...</span>, <span class='kw'>only_numerical</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>groups</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"partial"</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a ceteris paribus explainer produced with function `ceteris_paribus()`</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other explainers that shall be calculated together</p></td>
    </tr>
    <tr>
      <th>only_numerical</th>
      <td><p>a logical. If TRUE then only numerical variables will be calculated If FALSE then only categorical variables will be calculated</p></td>
    </tr>
    <tr>
      <th>groups</th>
      <td><p>a variable name that will be used for grouping. By default 'NULL' which means that no groups shall be calculated</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>either 'partial'/'conditional'/'accumulated' for parital dependence, conditional profiles of accumulated local effects</p></td>
    </tr>
    <tr>
      <th>variables</th>
      <td><p>if not NULL then aggregate only for selected `variables` will be calculated</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>an 'aggregated_profiles_explainer' layer</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Predictive Models: Visual Exploration, Explanation and Debugging <a href='https://pbiecek.github.io/PM_VEE'>https://pbiecek.github.io/PM_VEE</a></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"DALEX"</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"randomForest"</span>)
<span class='no'>titanic</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span>(<span class='no'>titanic</span>)
 <span class='no'>model_titanic_rf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/randomForest/man/randomForest.html'>randomForest</a></span>(<span class='no'>survived</span> ~ <span class='no'>gender</span> + <span class='no'>age</span> + <span class='no'>class</span> + <span class='no'>embarked</span> +
                                    <span class='no'>fare</span> + <span class='no'>sibsp</span> + <span class='no'>parch</span>,  <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>titanic</span>)
 <span class='no'>model_titanic_rf</span></div><div class='output co'>#&gt; 
#&gt; Call:
#&gt;  randomForest(formula = survived ~ gender + age + class + embarked +      fare + sibsp + parch, data = titanic) 
#&gt;                Type of random forest: classification
#&gt;                      Number of trees: 500
#&gt; No. of variables tried at each split: 2
#&gt; 
#&gt;         OOB estimate of  error rate: 18.82%
#&gt; Confusion matrix:
#&gt;       no yes class.error
#&gt; no  1324  94  0.06629055
#&gt; yes  301 380  0.44199706</div><div class='input'>
 <span class='no'>explain_titanic_rf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/explain.html'>explain</a></span>(<span class='no'>model_titanic_rf</span>,
                           <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>titanic</span>[,-<span class='fl'>9</span>],
                           <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>titanic</span>$<span class='no'>survived</span>)</div><div class='output co'>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  randomForest  (<span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; data              :  2099  rows  8  cols 
#&gt;   -&gt; target variable   :  2099  values 
#&gt;   -&gt; target variable   :  Please note that 'y' is a factor.  (</span><span style='color: #BB0000;'>WARNING</span><span>)
#&gt;   -&gt; target variable   :  Consider changing the 'y' to a logical or numerical vector.
#&gt;   -&gt; target variable   :  Otherwise I will not be able to calculate residuals or loss function.
#&gt;   -&gt; predict function  :  yhat.randomForest  will be used (</span><span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; predicted values  :  numerical, min =  0 , mean =  0.2384621 , max =  1  
#&gt;   -&gt; residual function :  difference between y and yhat (</span><span style='color: #BBBB00;'>default</span><span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: ‘-’ not meaningful for factors</span></div><div class='output co'>#&gt;   -&gt; residuals         :  numerical, min =  NA , mean =  NA , max =  NA  
#&gt; </span><span style='color: #00BB00;'>A new explainer has been created!</span><span></div><div class='input'>
<span class='no'>selected_passangers</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='select_sample.html'>select_sample</a></span>(<span class='no'>titanic</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>100</span>)
<span class='no'>cp_rf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='ceteris_paribus.html'>ceteris_paribus</a></span>(<span class='no'>explain_titanic_rf</span>, <span class='no'>selected_passangers</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>cp_rf</span>)</div><div class='output co'>#&gt; Top profiles    : 
#&gt;        gender age            class    embarked country    fare sibsp parch
#&gt; 557      male  50              2nd Southampton England 13.0000     0     0
#&gt; 557.1  female  50              2nd Southampton England 13.0000     0     0
#&gt; 660      male  25              3rd   Cherbourg Lebanon 14.0901     1     0
#&gt; 660.1  female  25              3rd   Cherbourg Lebanon 14.0901     1     0
#&gt; 1535     male  20 restaurant staff Southampton England  0.0000     0     0
#&gt; 1535.1 female  20 restaurant staff Southampton England  0.0000     0     0
#&gt;        _yhat_ _vname_ _ids_      _label_
#&gt; 557     0.006  gender   557 randomForest
#&gt; 557.1   0.924  gender   557 randomForest
#&gt; 660     0.052  gender   660 randomForest
#&gt; 660.1   0.498  gender   660 randomForest
#&gt; 1535    0.000  gender  1535 randomForest
#&gt; 1535.1  0.826  gender  1535 randomForest
#&gt; 
#&gt; 
#&gt; Top observations:
#&gt;      gender age            class    embarked       country    fare sibsp parch
#&gt; 557    male  50              2nd Southampton       England 13.0000     0     0
#&gt; 660    male  25              3rd   Cherbourg       Lebanon 14.0901     1     0
#&gt; 1535   male  20 restaurant staff Southampton       England  0.0000     0     0
#&gt; 942  female  59              2nd Southampton United States 26.0000     0     1
#&gt; 491    male  30              2nd Southampton       England 13.0000     0     0
#&gt; 1639   male  47 victualling crew Southampton       England  0.0000     0     0
#&gt;      _yhat_      _label_ _ids_
#&gt; 557   0.006 randomForest     1
#&gt; 660   0.052 randomForest     2
#&gt; 1535  0.000 randomForest     3
#&gt; 942   0.900 randomForest     4
#&gt; 491   0.008 randomForest     5
#&gt; 1639  0.000 randomForest     6</div><div class='input'>
<span class='co'># continouse variable</span>
<span class='no'>pdp_rf_p</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_profiles</span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"age"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"partial"</span>)
<span class='no'>pdp_rf_p</span>$<span class='no'>`_label_`</span> <span class='kw'>&lt;-</span> <span class='st'>"RF_partial"</span>
<span class='no'>pdp_rf_c</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_profiles</span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"age"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"conditional"</span>)
<span class='no'>pdp_rf_c</span>$<span class='no'>`_label_`</span> <span class='kw'>&lt;-</span> <span class='st'>"RF_conditional"</span>
<span class='no'>pdp_rf_a</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_profiles</span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"age"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"accumulated"</span>)
<span class='no'>pdp_rf_a</span>$<span class='no'>`_label_`</span> <span class='kw'>&lt;-</span> <span class='st'>"RF_accumulated"</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>pdp_rf_p</span>, <span class='no'>pdp_rf_c</span>, <span class='no'>pdp_rf_a</span>, <span class='kw'>color</span> <span class='kw'>=</span> <span class='st'>"_label_"</span>)</div><div class='img'><img src='aggregate_profiles-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='no'>pdp_rf</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_profiles</span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"age"</span>,
                             <span class='kw'>groups</span> <span class='kw'>=</span> <span class='st'>"gender"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>pdp_rf</span>)</div><div class='output co'>#&gt;   _vname_             _label_        _x_ _groups_ _yhat_ _ids_
#&gt; 1     age randomForest_female  0.1666667   female 0.7297     0
#&gt; 2     age randomForest_female  2.0000000   female 0.7103     0
#&gt; 3     age randomForest_female  4.0000000   female 0.7405     0
#&gt; 4     age randomForest_female  7.0000000   female 0.7314     0
#&gt; 5     age randomForest_female  9.0000000   female 0.7395     0
#&gt; 6     age randomForest_female 13.0000000   female 0.7553     0</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"age"</span>) +
  <span class='fu'><a href='show_observations.html'>show_observations</a></span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"age"</span>) +
  <span class='fu'><a href='show_rugs.html'>show_rugs</a></span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"age"</span>, <span class='kw'>color</span> <span class='kw'>=</span> <span class='st'>"red"</span>) +
  <span class='fu'><a href='show_aggregated_profiles.html'>show_aggregated_profiles</a></span>(<span class='no'>pdp_rf</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>color</span> <span class='kw'>=</span> <span class='st'>"_label_"</span>)</div><div class='img'><img src='aggregate_profiles-2.png' alt='' width='700' height='433' /></div><div class='input'>

<span class='co'># categorical variable</span>
<span class='no'>pdp_rf_p</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_profiles</span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"class"</span>, <span class='kw'>only_numerical</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"partial"</span>)
<span class='no'>pdp_rf_p</span>$<span class='no'>`_label_`</span> <span class='kw'>&lt;-</span> <span class='st'>"RF_partial"</span>
<span class='no'>pdp_rf_c</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_profiles</span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"class"</span>, <span class='kw'>only_numerical</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"conditional"</span>)
<span class='no'>pdp_rf_c</span>$<span class='no'>`_label_`</span> <span class='kw'>&lt;-</span> <span class='st'>"RF_conditional"</span>
<span class='no'>pdp_rf_a</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_profiles</span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"class"</span>, <span class='kw'>only_numerical</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"accumulated"</span>)
<span class='no'>pdp_rf_a</span>$<span class='no'>`_label_`</span> <span class='kw'>&lt;-</span> <span class='st'>"RF_accumulated"</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>pdp_rf_p</span>, <span class='no'>pdp_rf_c</span>, <span class='no'>pdp_rf_a</span>, <span class='kw'>color</span> <span class='kw'>=</span> <span class='st'>"_label_"</span>)</div><div class='img'><img src='aggregate_profiles-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># or maybe flipped?</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>ggplot2</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘ggplot2’</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from ‘package:randomForest’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    margin</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>pdp_rf_p</span>, <span class='no'>pdp_rf_c</span>, <span class='no'>pdp_rf_a</span>, <span class='kw'>color</span> <span class='kw'>=</span> <span class='st'>"_label_"</span>) + <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span>()</div><div class='img'><img src='aggregate_profiles-4.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='no'>pdp_rf</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_profiles</span>(<span class='no'>cp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"class"</span>, <span class='kw'>only_numerical</span><span class='kw'>=</span><span class='fl'>FALSE</span>,
                             <span class='kw'>groups</span> <span class='kw'>=</span> <span class='st'>"gender"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>pdp_rf</span>)</div><div class='output co'>#&gt;   _vname_             _label_              _x_ _groups_ _yhat_ _ids_
#&gt; 1   class randomForest_female              1st   female 0.8698     0
#&gt; 2   class randomForest_female              2nd   female 0.8589     0
#&gt; 3   class randomForest_female              3rd   female 0.5760     0
#&gt; 4   class randomForest_female        deck crew   female 0.8182     0
#&gt; 5   class randomForest_female engineering crew   female 0.7072     0
#&gt; 6   class randomForest_female restaurant staff   female 0.6937     0</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>pdp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"class"</span>)</div><div class='img'><img src='aggregate_profiles-5.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># or maybe flipped?</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>pdp_rf</span>, <span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"class"</span>) + <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span>()</div><div class='img'><img src='aggregate_profiles-6.png' alt='' width='700' height='433' /></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>

